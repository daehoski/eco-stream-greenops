# 1. í…ŒìŠ¤íŠ¸ìš© ì›Œì»¤ ë°°í¬ (eco-worker)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: eco-worker
  namespace: default
spec:
  replicas: 0          # ì´ˆê¸° ìƒíƒœëŠ” 0 (GreenOps ì „ë ¥ ì ˆê°)
  selector:
    matchLabels:
      app: eco-worker
  template:
    metadata:
      labels:
        app: eco-worker
    spec:
      containers:
      - name: worker
        image: busybox
        command: ["/bin/sh", "-c", "sleep 3600"]
        lifecycle:
          postStart:
            exec:
              # íŒŒë“œ ìƒì„± ì‹œ ë§ˆìŠ¤í„° ë…¸ë“œì˜ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡
              command: ["/bin/sh", "-c", "echo \"[$(date)] ğŸŸ¢ [GreenOps] KEDA Trigger: Worker 2 ë¶€íŒ… ì‹ í˜¸ ì „ì†¡\" >> /var/log/greenops.log"]
          preStop:
            exec:
              # íŒŒë“œ ì‚­ì œ ì‹œ ë§ˆìŠ¤í„° ë…¸ë“œì˜ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡
              command: ["/bin/sh", "-c", "echo \"[$(date)] ğŸ”´ [GreenOps] KEDA Trigger: Worker 2 ì ˆì „ ëª¨ë“œ ì§„ì…\" >> /var/log/greenops.log"]
        volumeMounts:
        - name: log-vol
          mountPath: /var/log
      volumes:
      - name: log-vol
        hostPath:
          path: /var/log  # ë§ˆìŠ¤í„° ë…¸ë“œì˜ ì‹¤ì œ ê²½ë¡œì™€ ë™ê¸°í™”
---
# 2. KEDA ìŠ¤ì¼€ì¼ë§ ì„¤ì • (ScaledObject)
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: kafka-scaledobject
  namespace: default
spec:
  scaleTargetRef:
    name: eco-worker
  pollingInterval: 5      # 5ì´ˆë§ˆë‹¤ ì²´í¬
  cooldownPeriod:  30     # ì¼ ëë‚˜ê³  30ì´ˆ ë’¤ì— ì¢…ë£Œ
  minReplicaCount: 0      # ìµœì†Œ 0ê°œ (Scale to Zero)
  maxReplicaCount: 10     # ìµœëŒ€ 10ê°œ
  triggers:
- type: cpu
    metadata:
      type: Utilization
      value: "10" # CPU ì‚¬ìš©ëŸ‰ì´ 10%ë§Œ ë„˜ì–´ë„ íŒŒë“œë¥¼ ëŠ˜ë ¤ë¼!